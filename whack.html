<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whack-a-Mole</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
        }
        
        #game-container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #4CAF50;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }
        
        #game-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .hole {
            position: relative;
            width: 100%;
            height: 150px;
            background-color: #8B4513;
            border-radius: 50%;
            cursor: pointer;
            overflow: hidden;
        }
        
        .hole::after {
            content: '';
            position: absolute;
            bottom: -30px;
            left: 0;
            right: 0;
            height: 60px;
            background-color: #000;
            border-radius: 50%;
        }
        
        .mole {
            position: absolute;
            width: 80px;
            height: 80px;
            background-color: #A0522D;
            border-radius: 50%;
            bottom: -80px;
            left: 50%;
            transform: translateX(-50%);
            transition: bottom 0.3s;
            cursor: pointer;
        }
        
        .mole.up {
            bottom: 20px;
        }
        
        .mole::before, .mole::after {
            content: '';
            position: absolute;
            background-color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            top: 15px;
        }
        
        .mole::before {
            left: 15px;
        }
        
        .mole::after {
            right: 15px;
        }
        
        .mole-hit {
            background-color: red;
        }
        
        #score-display, #time-display {
            font-size: 24px;
            margin: 10px 0;
            color: white;
        }
        
        #controls {
            margin: 20px 0;
        }
        
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #FF9800;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        button:hover {
            background-color: #F57C00;
        }
        
        #game-over {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        #game-over h2 {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        #final-score {
            font-size: 36px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h1>Whack-a-Mole!</h1>
        <div id="score-display">Score: 0</div>
        <div id="time-display">Time: 30</div>
        
        <div id="game-board">
            <!-- Holes will be generated by JavaScript -->
        </div>
        
        <div id="controls">
            <button id="start-btn">Start Game</button>
        </div>
    </div>
    
    <div id="game-over">
        <h2>Game Over!</h2>
        <div id="final-score">Score: 0</div>
        <button id="restart-btn">Play Again</button>
    </div>

    <script>
        // Game variables
        let score = 0;
    let timeLeft = 30;
    let gameActive = false;
    let timer;
    let moleTimer;
    let holes = [];
    const MOLE_MIN_VISIBLE_TIME = 800;  // Minimum time mole stays up (ms)
    const MOLE_MAX_VISIBLE_TIME = 1050; // Maximum time mole stays up (ms)
    const MOLE_INTERVAL = 900;          // Time between mole appearances (ms)
    let activeMoles = 0;
const MAX_ACTIVE_MOLES = 1; // Only 1 mole at a time
let lastMoleTime = 0;
const MOLE_COOLDOWN = 500;
        
        // DOM elements
        const gameBoard = document.getElementById('game-board');
        const scoreDisplay = document.getElementById('score-display');
        const timeDisplay = document.getElementById('time-display');
        const startBtn = document.getElementById('start-btn');
        const gameOverScreen = document.getElementById('game-over');
        const finalScoreDisplay = document.getElementById('final-score');
        const restartBtn = document.getElementById('restart-btn');
        
        // Create holes
        function createHoles() {
            gameBoard.innerHTML = '';
            holes = [];
            
            for (let i = 0; i < 9; i++) {
                const hole = document.createElement('div');
                hole.className = 'hole';
                hole.dataset.index = i;
                
                const mole = document.createElement('div');
                mole.className = 'mole';
                mole.dataset.index = i;
                
                hole.appendChild(mole);
                gameBoard.appendChild(hole);
                holes.push({
                    element: mole,
                    isUp: false,
                    index: i
                });
                
                // Add click event to moles
                mole.addEventListener('click', whackMole);
            }
        }
        
        // Start the game
        function startGame() {
    // Clear any existing mole timer
    if (moleTimer) {
        clearTimeout(moleTimer);
    }
    
    score = 0;
    timeLeft = 30;
    gameActive = true;
    activeMoles = 0;
    lastMoleTime = 0;
    
    scoreDisplay.textContent = `Score: ${score}`;
    timeDisplay.textContent = `Time: ${timeLeft}`;
    
    startBtn.disabled = true;
    
    // Start timer
    timer = setInterval(() => {
        timeLeft--;
        timeDisplay.textContent = `Time: ${timeLeft}`;
        
        if (timeLeft <= 0) {
            endGame();
        }
    }, 1000);
    
    // Start mole popping
    popRandomMoleWithDelay();
}

    // Pop up a random mole with proper timing
    function popRandomMoleWithDelay() {
    if (!gameActive) return;
    
    const now = Date.now();
    
    // First check if any moles have exceeded their display time
    holes.forEach(hole => {
        if (hole.isUp && now - hole.showTime >= hole.visibleDuration) {
            hideMole(hole);
        }
    });
    
    // Don't show new mole if:
    // - We already have max active moles
    // - Not enough time has passed since last mole
    if (activeMoles >= MAX_ACTIVE_MOLES || now - lastMoleTime < MOLE_COOLDOWN) {
        setTimeout(popRandomMoleWithDelay, 100);
        return;
    }
    
    // Get random visible time for this mole (800-1500ms)
    const visibleDuration = MOLE_MIN_VISIBLE_TIME + 
                         Math.random() * (MOLE_MAX_VISIBLE_TIME - MOLE_MIN_VISIBLE_TIME);
    
    // Get random hole that doesn't currently have a mole
    const availableHoles = holes.filter(hole => !hole.isUp);
    if (availableHoles.length === 0) {
        setTimeout(popRandomMoleWithDelay, 100);
        return;
    }
    
    const randomIndex = Math.floor(Math.random() * availableHoles.length);
    const mole = availableHoles[randomIndex];
    
    showMole(mole, visibleDuration);
    lastMoleTime = now;
    
    // Schedule next mole appearance
    setTimeout(popRandomMoleWithDelay, MOLE_INTERVAL);
}

// New helper functions
function showMole(mole, duration) {
    mole.element.classList.add('up');
    mole.isUp = true;
    mole.showTime = Date.now();
    mole.visibleDuration = duration;
    activeMoles++;
}

function hideMole(mole) {
    mole.element.classList.remove('up');
    mole.isUp = false;
    activeMoles--;
}


// Update the whackMole function
function whackMole(e) {
    if (!gameActive) return;
    
    const moleIndex = parseInt(e.target.dataset.index);
    const mole = holes[moleIndex];
    
    if (mole.isUp) {
        // Add hit effect
        e.target.classList.add('mole-hit');
        setTimeout(() => {
            e.target.classList.remove('mole-hit');
        }, 200);
        
        // Hide the mole immediately when whacked
        hideMole(mole);
        
        // Increase score
        score++;
        scoreDisplay.textContent = `Score: ${score}`;
    }
}
        
        // End the game
        function endGame() {
    gameActive = false;
    clearInterval(timer);
    
    // Clear any pending mole timeouts
    if (moleTimer) {
        clearTimeout(moleTimer);
    }
    
    // Hide all moles immediately
    holes.forEach(hole => {
        if (hole.isUp) {
            hole.element.classList.remove('up');
            hole.isUp = false;
        }
    });
    
    activeMoles = 0; // Reset active mole count
    
    // Show game over screen
    finalScoreDisplay.textContent = `Final Score: ${score}`;
    gameOverScreen.style.display = 'flex';
}
        // Restart game
        function restartGame() {
    // Hide game over screen
    gameOverScreen.style.display = 'none';
    
    // Reset all game state
    score = 0;
    activeMoles = 0;
    lastMoleTime = 0;
    
    // Update displays
    scoreDisplay.textContent = `Score: ${score}`;
    timeDisplay.textContent = `Time: 30`;
    
    // Re-enable start button
    startBtn.disabled = false;
    
    // Clear any existing moles
    holes.forEach(hole => {
        hole.element.classList.remove('up');
        hole.isUp = false;
    });
}

        
        // Event listeners
        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', restartGame);
        
        // Initialize the game
        createHoles();
    </script>
</body>
</html>